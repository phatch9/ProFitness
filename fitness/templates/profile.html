{% extends "user_dashboard_template.html" %}

{% block title %}
<title>User Profile - ProFitness</title>
{% endblock %}

{% block content %}
<div class="row">
    <!-- Profile Information Card -->
    <div class="col-xl-8 col-lg-7">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Profile</h6>
            </div>
            <div class="card-body">
                <form method="POST" action="">
                    {{ form.hidden_tag() }}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                {{ form.first_name.label(class="form-control-label") }}
                                {% if form.first_name.errors %}
                                    {{ form.first_name(class="form-control is-invalid") }}
                                    <div class="invalid-feedback">
                                        {% for error in form.first_name.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    {{ form.first_name(class="form-control") }}
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                {{ form.last_name.label(class="form-control-label") }}
                                {% if form.last_name.errors %}
                                    {{ form.last_name(class="form-control is-invalid") }}
                                    <div class="invalid-feedback">
                                        {% for error in form.last_name.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    {{ form.last_name(class="form-control") }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        {{ form.email.label(class="form-control-label") }}
                        {% if form.email.errors %}
                            {{ form.email(class="form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.email.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.email(class="form-control") }}
                        {% endif %}
                    </div>
                    <hr>
                    <h6 class="font-weight-bold text-primary">Change Password (Optional)</h6>
                    <div class="form-group">
                        {{ form.current_password.label(class="form-control-label") }}
                        {% if form.current_password.errors %}
                            {{ form.current_password(class="form-control is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.current_password.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ form.current_password(class="form-control") }}
                        {% endif %}
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                {{ form.new_password.label(class="form-control-label") }}
                                {% if form.new_password.errors %}
                                    {{ form.new_password(class="form-control is-invalid") }}
                                    <div class="invalid-feedback">
                                        {% for error in form.new_password.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    {{ form.new_password(class="form-control") }}
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                {{ form.confirm_new_password.label(class="form-control-label") }}
                                {% if form.confirm_new_password.errors %}
                                    {{ form.confirm_new_password(class="form-control is-invalid") }}
                                    <div class="invalid-feedback">
                                        {% for error in form.confirm_new_password.errors %}
                                            <span>{{ error }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    {{ form.confirm_new_password(class="form-control") }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        {{ form.submit(class="btn btn-primary btn-block") }}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- User Stats Card -->
    <div class="col-xl-4 col-lg-5">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Account Statistics</h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                        Member Since
                    </div>
                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                        {{ session['fname'] }} {{ current_user.lname }}
                    </div>
                </div>
                <div class="mb-3">
                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                        Current Perks
                    </div>
                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                        {{ perk }} points
                    </div>
                </div>
                <div class="mb-3">
                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                        Achievement Level
                    </div>
                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                        {{ achievement }}%
                    </div>
                </div>
                <div class="mb-3">
                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                        Today's Calories Burned
                    </div>
                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                        {{ total }} calories
                    </div>
                </div>
                <div class="mb-3">
                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                        Monthly Calories Burned
                    </div>
                    <div class="h6 mb-0 font-weight-bold text-gray-800">
                        {{ monthly_calories }} calories
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Card -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <a href="/user" class="btn btn-primary btn-sm btn-block">
                        <i class="fas fa-tachometer-alt fa-fw mr-2"></i>Dashboard
                    </a>
                </div>
                <div class="mb-2">
                    <a href="/workout-history" class="btn btn-info btn-sm btn-block">
                        <i class="fas fa-history fa-fw mr-2"></i>Workout History
                    </a>
                </div>
                <div class="mb-2">
                    <a href="/exercises" class="btn btn-success btn-sm btn-block">
                        <i class="fas fa-dumbbell fa-fw mr-2"></i>Exercise Library
                    </a>
                </div>
                <div class="mb-2">
                    <a href="/todolist" class="btn btn-warning btn-sm btn-block">
                        <i class="fas fa-tasks fa-fw mr-2"></i>Todo List
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'danger' else 'success' }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}
{% endblock %} 